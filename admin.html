---
layout: null
---
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理画面</title>
  <link rel="stylesheet" href="{{ '/assets/css/admin.css' | relative_url }}">
</head>
<body>
  <!-- ログインフォーム -->
  <div class="login" id="login-form">
    <h2>管理者ログイン</h2>
    <input type="email" id="email" placeholder="メールアドレス">
    <input type="password" id="password" placeholder="パスワード">
    <button id="login-btn">ログイン</button>
  </div>

  <!-- 記事エディタ (ログイン後に表示) -->
  <div class="editor" id="editor" style="display:none;">
    <h2>新規記事投稿</h2>
    <input id="title" placeholder="タイトル">
    <select id="category">
      <option value="plugin">プラグイン</option>
      <option value="mod">Mod</option>
      <option value="vanilla">バニラ</option>
      <option value="server">サーバー</option>
      <option value="commands">コマンド</option>
    </select>
    <input id="slug" placeholder="URLスラグ（例: plugin/kizi1）">
    <textarea id="content" placeholder="記事本文 (HTML)"></textarea>
    <button id="publish-btn">公開</button>
    <button id="logout-btn">ログアウト</button>
  </div>

  <!-- Firebase SDK 読み込み -->
  {% include head.html %}
  <script>
    // auth, db は head.html で初期化済み

    const loginForm = document.getElementById('login-form');
    const editor = document.getElementById('editor');

    // 認証状態の監視
    auth.onAuthStateChanged(user => {
      if (user) {
        // 管理者メールでない場合は強制ログアウト
        if (user.email !== '管理者のメールアドレス@example.com') {
          auth.signOut();
          alert('管理者以外はアクセスできません');
          return;
        }
        loginForm.style.display = 'none';
        editor.style.display = 'block';
      } else {
        loginForm.style.display = 'block';
        editor.style.display = 'none';
      }
    });

    // ログイン実行
    document.getElementById('login-btn').onclick = () => {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, pass)
        .catch(err => alert('ログイン失敗: ' + err.message));
    };

    // ログアウト
    document.getElementById('logout-btn').onclick = () => auth.signOut();

    // 記事投稿
    document.getElementById('publish-btn').onclick = () => {
      const data = {
        title: document.getElementById('title').value,
        category: document.getElementById('category').value,
        slug: document.getElementById('slug').value,
        content: document.getElementById('content').value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
      };
      db.collection('posts').add(data)
        .then(() => alert('投稿完了'))
        .catch(err => alert('投稿エラー: ' + err.message));
    };
  </script>
</body>
</html>
